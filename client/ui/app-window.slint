import { VerticalBox, Button, Palette } from "std-widgets.slint";
import { CardsDisplay } from "cards-display.slint";
import { CardSuitSlint, CardRankSlint, CardSlint, PlayerSlint, AppState } from "structs.slint";
import { HomeScreen } from "home-screen.slint";
import { PlayersDisplay } from "player-display.slint";

export component MainWindow inherits Window {
    callback play_card(card: CardSlint);
    callback set_position(from: int, to: int);
    callback submit_name(name: string);
    callback join_game;
    
    in-out property<[CardSlint]> hand;
    in property <string> name;
    in-out property<AppState> app_state;
    in-out property<[PlayerSlint]> players;

    Rectangle {
        background: @radial-gradient(circle, #007400 0%, #004400 100%);
    }

    Rectangle {
        height: 100px;
        width: 100px;
        x: 0;
        y: 0;
        background: rgb(255, 0, 0);
        transform-rotation: 45deg;
        transform-origin: {x: self.width / 2, y: self.height / 2};
    }

    CardsDisplay { 
        hand: hand;
        play_card(card) => root.play_card(card);
        set_position(from, to) => root.set_position(from, to);
    }

    if (app_state == AppState.Lobby || app_state == AppState.Login) : HomeScreen {
        clicked => root.join_game();
    }

    if (app_state == AppState.PendingGame || app_state == AppState.Game) : PlayersDisplay {
        x: 0;
        y: 0;
        width: max(root.width * 30%, 200px);
        players: root.players;
        self-name: root.name;
    }

    property <string> input_text: "";

    if (app_state == AppState.Login) : Rectangle {
        width: 70%;
        height: 40%;
        border-radius: 10px;
        border-color: rgb(200, 200, 200);
        background: Palette.background;
        drop-shadow-blur:  5px;
        drop-shadow-color: rgba(0, 0, 0, 0.2);
        drop-shadow-offset-x: 5px;
        drop-shadow-offset-y: 5px;

        VerticalBox {
            x: parent.width * 10%;
            y: parent.height * 20%;
            width: 80%;
            height: 40px;

            input := TextInput { 
               color: Palette.control-foreground;
                edited => {
                    root.input_text = self.text;
                }
            }
        }

        Text {
            x: parent.width * 10% + 7px;
            y: parent.height * 20% + 9px;
            text: "enter name";
            color: rgb(150, 150, 150);
            visible: root.input_text == "";
        }

        Button {
            x: parent.width * 10%;
            y: parent.height * 60%;
            width: 80%;
            height: 20%;
            text: "OK";
            clicked => root.submit_name(input.text);
        }
    }
}
